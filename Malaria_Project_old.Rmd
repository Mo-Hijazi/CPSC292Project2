---
title: "TEST PROJECT"
author: "Mo Hijazi"
date: "10/16/2021"
output: html_document
---
---
title: "Project 1 - Malaria"
author: "Mo Hijazi"
date: "10/12/2021"
output: html_document
---
```{r}
# All libraries required for code.
library(ggplot2)
library(reshape2)
library(tidyr)
library(janitor)
library(packcircles)
library(viridis)
library(viridisLite)
library(maps)
library(tidyverse)
library(scales)
```

Loading in the data set "malaria_data.csv." The data set contains malaria related deaths in different countries in relation to age. 
```{r setup, include=T}
knitr::opts_chunk$set(echo = TRUE)

#Loading in the csv file. 
malaria <- read.csv("malaria_data_2.csv", skip = 1)
```

Cleaning up the data set: 
```{r setup, include=T}

#Renaming specific countries on the data to match the world map names.
malaria$Entity[1401:1428] <- "Ivory Coast"
malaria$Entity[1345:1372] <- "Democratic Republic of the Congo"
malaria$Entity[1541:1568] <- "Democratic Republic of the Congo"
malaria$Entity[1065:1092] <- "China"
malaria$Entity[1121:1148] <- "Spain"
malaria$Entity[1681:1708] <- "China"
malaria$Entity[5209:5236] <- "China"
malaria$Entity[5293:5348] <- "China"

#Making sure the data is numeric for calculations.
malaria$Entity <- factor(malaria$Entity) 
malaria$Deaths...Malaria...Sex..Both...Age..Under.5..Number. <- as.numeric(malaria$Deaths...Malaria...Sex..Both...Age..Under.5..Number.)
malaria$Deaths...Malaria...Sex..Both...Age..70..years..Number. <- as.numeric(malaria$Deaths...Malaria...Sex..Both...Age..70..years..Number.)
malaria$Deaths...Malaria...Sex..Both...Age..5.14.years..Number. <- as.numeric(malaria$Deaths...Malaria...Sex..Both...Age..5.14.years..Number.)
malaria$Deaths...Malaria...Sex..Both...Age..15.49.years..Number. <- as.numeric(malaria$Deaths...Malaria...Sex..Both...Age..15.49.years..Number.)
malaria$Deaths...Malaria...Sex..Both...Age..50.69.years..Number. <- as.numeric(malaria$Deaths...Malaria...Sex..Both...Age..50.69.years..Number.)

#Cleaning up the column names, removing unneeded columns, and omitting any NA values.
clean_names(malaria)
malaria <- subset(malaria, select = -2)
malaria <- subset(malaria, select = -2)
malaria <- na.omit(malaria)



```

Creating a data frame with all age groups combined:
```{r setup, include=T}
#combining all column of death by age into 1 column.
malaria.all <- rowSums(malaria[1:6440,2:5])

#creating data frame with the country names and binding it with the death sums.
malaria.country <- data.frame(malaria[,1])
malaria.all <- cbind(malaria.country,malaria.all)

#Renaming column names.
names(malaria.all)[2] <- "deaths"
names(malaria.all)[1] <- "region"
```

Combining world map data with my data to create visual: 
(WARNING THIS TAKES ~20 MINUTES TO LOAD)
```{r setup, include=T}
#Leading in map data (lat and long values).
mapdata <- map_data("world")

#Combining my data with map values.
mapdata1 <- malaria.all %>%
  right_join(mapdata, by= "region") %>%
  group_by(region)
#Removing uneeded column
mapdata1 <- subset(mapdata1, select = -7)

#creating a map that will have different shades of colors depending on the # of deaths per country. 
ggplot(mapdata1, aes(long, lat, group=group))+
  geom_polygon(aes(fill=deaths), na.rm="grey80")+ # This line is important because we dont have data for every country to it the "na.rm" still allows for those countries to appear on the map. 
  scale_fill_continuous(na.value = 'blue')+
  scale_fill_gradient(name = "Number of Deaths", low = "blue", high = "red")+ #Low death counts are blue and high death rates as red. 
  theme(axis.text.x = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        rect = element_blank()) #Removing all axis elements. 

```

VISUAL 2:
```{r setup, include=T}
#Loading in the csv file. 
Visual2malaria <- read.csv("malaria_data.csv", skip = 1)
#creating a data frame with just "world" death counts
Visual2malaria <- data.frame(Visual2malaria[6357:6384,]) 
#Removing unneeded columns
Visual2malaria <- subset(Visual2malaria, select = -2)
Visual2malaria <- subset(Visual2malaria, select = -1)
#making year counts as characters for easier visual edits. 
Visual2malaria$Year <- as.character(Visual2malaria$Year)
#Combining column deaths. 
total.deaths <- rowSums(Visual2malaria[,2:6])
year <- Visual2malaria$Year
#Creating a new data fram with years and total deaths.
malaria.world <- cbind(year, total.deaths)
malaria.world <- as.data.frame(malaria.world)

```


```{r setup, include=T}
#Making all death counts into numeric values.
malaria.world$total.deaths <- as.numeric(malaria.world$total.deaths)
#Creating bar graph and making aes edits to bar graph.
ggplot(malaria.world, aes(x= year, y= total.deaths, fill = year))+
  theme_dark()+
  geom_bar(stat = "identity")+ 
  theme(text = element_text(size=10),
        axis.text.x = element_text(angle=90, hjust=1))+
  scale_y_continuous(name="Total Deaths", breaks= seq(0,1000000, by= 100000), labels = comma, expand = c(0, 0))+
  xlab("Year")+
  ggtitle("Total Malaria Deaths per Year")+
  theme(legend.position = "none")+ 
  theme(plot.title = element_text(hjust = 0.5))
```
Resources:
https://stackoverflow.com/questions/61838700/query-on-how-to-make-world-heat-map-using-ggplot-in-r
https://stackoverflow.com/questions/42683522/r-how-to-sum-a-variable-by-certain-levels-contained-in-a-list-of-another-varia
https://www.youtube.com/watch?v=AgWgPSZ7Gp0
https://stackoverflow.com/questions/13353213/gradient-of-n-colors-ranging-from-color-1-and-color-2
https://stackoverflow.com/questions/60268389/china-not-showing-on-chloropleth-map-in-r
https://www.youtube.com/watch?v=AgWgPSZ7Gp0
https://www.datanovia.com/en/blog/how-to-remove-legend-from-a-ggplot/
https://www.datanovia.com/en/lessons/rename-data-frame-columns-in-r/
http://www.sthda.com/english/wiki/ggplot2-barplots-quick-start-guide-r-software-and-data-visualization
https://www.r-graph-gallery.com/218-basic-barplots-with-ggplot2.html
https://stackoverflow.com/questions/1330989/rotating-and-spacing-axis-labels-in-ggplot2
https://www.datanovia.com/en/blog/how-to-set-ggplot-breaks/
http://www.sthda.com/english/wiki/ggplot2-axis-ticks-a-guide-to-customize-tick-marks-and-labels
https://stackoverflow.com/questions/40675778/center-plot-title-in-ggplot2
https://statisticsglobe.com/change-formatting-of-numbers-of-ggplot2-plot-axis-in-r
https://stackoverflow.com/questions/13701347/force-the-origin-to-start-at-0



